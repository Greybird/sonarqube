<%
   selected_section = controller.class::SECTION if defined?(controller.class::SECTION)
   if selected_section==Navigation::SECTION_RESOURCE && !@project && !@resource
     selected_section = Navigation::SECTION_HOME
   end
   @project=@resource unless @project || selected_section==Navigation::SECTION_HOME
   period_param = "period=#{u(params[:period])}" if params[:period]
%>
<div id="container">
  <nav class="navbar <% if selected_section==Navigation::SECTION_RESOURCE %>navbar-primary<% end %>">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand navbar-logo" href="<%= ApplicationController.root_context -%>/">
          <%= render 'layouts/logo' -%>
        </a>
        <% if selected_section==Navigation::SECTION_RESOURCE %>
          <div class="navbar-brand"><%= @project.name -%></div>
        <% end %>
      </div>
    </div>
  </nav>

  <%= yield :header -%>

  <%= render 'layouts/breadcrumb' if @breadcrumbs || selected_section==Navigation::SECTION_RESOURCE -%>

  <div id="body">
    <div class="container">
      <% if selected_section && selected_section.show_sidebar && !@hide_sidebar %>
        <% unless selected_section==Navigation::SECTION_HOME || selected_section==Navigation::SECTION_RESOURCE %>
          <div id="sidebar">
            <ul class="sidebar blue-sidebar">
              <% if selected_section==Navigation::SECTION_CONFIGURATION %>

                <% if is_admin? %>

                  <li class="sidebar-title"><%= message('sidebar.project_settings') -%></li>
                  <li class="<%= 'active' if request.request_uri.include?('/settings') -%>">
                    <a href="<%= ApplicationController.root_context -%>/settings/index"><%= message('settings.page') -%></a>
                  </li>
                  <li class="<%= 'active' if controller.controller_path=='metrics' -%>">
                    <a href="<%= ApplicationController.root_context -%>/metrics/index"><%= message('manual_metrics.page') -%></a>
                  </li>
                  <li class="<%= 'active' if controller.controller_path=='admin_dashboards' -%>">
                    <a href="<%= ApplicationController.root_context -%>/admin_dashboards/index"><%= message('default_dashboards.page') -%></a>
                  </li>
                  <% controller.java_facade.getPages(Navigation::SECTION_CONFIGURATION.key, nil, nil, nil, nil).each do |page|
                    page_url = (page.isController() ? page.getId() : "/plugins/configuration/#{page.getId()}")
                  %>
                    <li class="<%= 'active' if request.request_uri.include?(page_url) -%>">
                      <a href="<%= ApplicationController.root_context -%><%= page_url -%>"><%= h message(page.getId() + '.page', :default => page.getTitle()) %></a>
                    </li>
                  <% end %>
                  <li class="spacer"></li>
                  <li class="sidebar-title"><%= message('sidebar.security') -%></li>
                  <li class="<%= 'active' if request.request_uri.include?('/users') -%>">
                    <a href="<%= ApplicationController.root_context -%>/users"><%= message('users.page') -%></a>
                  </li>
                  <li class="<%= 'active' if request.request_uri.include?('/groups') -%>">
                    <a href="<%= ApplicationController.root_context -%>/groups/index"><%= message('user_groups.page') -%></a>
                  </li>
                  <li class="<%= 'active' if request.request_uri.include?('/roles/global') -%>">
                    <a href="<%= ApplicationController.root_context -%>/roles/global"><%= message('global_permissions.page') -%></a>
                  </li>
                  <li class="<%= 'active' if request.request_uri.include?('/roles/projects') || request.request_uri.include?('/permission_templates') -%>">
                    <a href="<%= ApplicationController.root_context -%>/roles/projects"><%= message('roles.page') -%></a>
                  </li>

                  <li class="spacer"></li>
                  <li class="sidebar-title"><%= message('sidebar.system') -%></li>
                  <% if has_role?("provisioning") %>
                    <li class="<%= 'active' if controller.controller_path=='provisioning' -%>">
                      <a href="<%= ApplicationController.root_context -%>/provisioning"><%= message('provisioning.page') -%></a>
                    </li>
                  <% end %>
                  <li class="<%= 'active' if controller.controller_path=='bulk_deletion' -%>">
                    <a href="<%= ApplicationController.root_context -%>/bulk_deletion"><%= message('bulk_deletion.page') -%></a>
                  </li>
                  <% update_center_activated = controller.java_facade.getSettings().getBoolean('sonar.updatecenter.activate')
                     if update_center_activated %>
                    <li class="<%= 'active' if controller.controller_path=='updatecenter' -%>">
                      <a href="<%= ApplicationController.root_context -%>/updatecenter"><%= message('update_center.page') -%></a>
                    </li>
                  <% end %>
                  <li class="<%= 'active' if controller.controller_path=='system' -%>">
                    <a href="<%= ApplicationController.root_context -%>/system"><%= message('system_info.page') -%></a>
                  </li>
                  <li class="<%= 'active' if controller.controller_path=='analysis_reports' -%>">
                    <a href="<%= ApplicationController.root_context -%>/analysis_reports"><%= message('analysis_reports.page') -%></a>
                  </li>

                <% end #of admin part    %>

              <% end %>

              <%= yield :sidebar %>
            </ul>
          </div>
        <% end %>
      <% end %>
      <div id="content">
        <% if @project %>
          <div class="print"><h2><%= h @project.name() %></h2></div>
        <% end %>
        <div class="error" id="error" style="display:none">
          <span id="errormsg"></span> &nbsp;&nbsp;[<a href="#" onclick="javascript:$j('#error').hide();return false;"><%= message('hide').downcase -%></a>]
        </div>
        <div class="notice" id="info" style="display:none">
          <span id="infomsg"></span> &nbsp;&nbsp;[<a href="#" onclick="javascript:$j('#info').hide();return false;"><%= message('hide').downcase -%></a>]
        </div>
        <div class="warning" id="warning" style="display:none">
          <span id="warningmsg"></span> &nbsp;&nbsp;[<a href="#" onclick="javascript:$j('#warning').hide();return false;"><%= message('hide').downcase -%></a>]
        </div>
        <%= yield %>
      </div>
    </div>
  </div>
</div>

<% unless params[:hd]=='false' %>
  <%= yield :footer %>
  <div id="footer">
    <% controller.java_facade.getWebFooters().each do |footer| %>
      <% if footer.getHtml() %>
        <div><%= footer.getHtml().to_s %></div>
      <% end %>
    <% end %>
    <div id="ftlinks">
      <%= render 'branding/footer' -%>
      <div>
        Version <%= sonar_version -%> -
        <a href="http://www.gnu.org/licenses/lgpl-3.0.txt" target="lgpl_v3">LGPL v3</a> -
        <a href="http://www.sonarqube.org" target="sonar">Community</a> -
        <a href="http://www.sonarqube.org/documentation" target="sonar_doc">Documentation</a> -
        <a href="http://www.sonarqube.org/support" target="support">Get Support</a> -
        <a href="http://sonar-plugins.codehaus.org" target="plugins">Plugins</a> -
        <a href="<%= ApplicationController.root_context -%>/api_documentation">Web Service API</a>
        <% unless DatabaseVersion.production? %>
          <br><br><span class="error big" id="evaluation_warning">Embedded database should be used for evaluation purpose only</span>
          <br><br><span class="error">The embedded database will not scale, it will not support upgrading to newer versions of SonarQube, and there is no support for migrating your data out of it into a different database engine.</span>
        <% end %>
      </div>
      <!--[if lte IE 8 ]><br/><span class="ie-warn">IE 8 is not supported. Some widgets may not be properly displayed. Please switch to a <a
          target="_blank" href="http://redirect.sonarsource.com/doc/requirements.html">supported version or another supported browser</a>.</span><!--<![endif]-->
    </div>
  </div>
<% end %>
